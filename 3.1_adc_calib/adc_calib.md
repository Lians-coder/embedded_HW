# 3.1 ADC Calibration

## Schematic

[KiCad schematic](https://github.com/Lians-coder/embedded_HW/blob/main/3.1_adc_calib/adc_calib.kicad_sch)  

## Code

[main.cpp](https://github.com/Lians-coder/embedded_HW/blob/main/3.1_adc_calib/src/main.cpp)  

## Result

### Output

<details>

<summary>Serial output</summary>

```txt
RAW    U_man(mV)    U_cal(mV)    Error(%)
-----------------------------------------
 109     87.84           99    -11.27
 137    110.40          124    -10.97
 140    112.82          126    -10.46
 150    120.88          135    -10.46
 173    139.41          156    -10.63
 202    162.78          182    -10.56
 253    203.88          226     -9.79
 295    237.73          263     -9.61
 278    224.03          248     -9.67
 275    221.61          245     -9.55
 314    253.04          280     -9.63
 350    282.05          311     -9.31
 427    344.10          377     -8.73
 493    397.29          434     -8.46
 603    485.93          527     -7.79
 703    566.52          613     -7.58
 857    690.62          740     -6.67
1069    861.47          918     -6.16
1269   1022.64         1085     -5.75
1439   1159.63         1226     -5.41
RAW    U_man(mV)    U_cal(mV)    Error(%)
-----------------------------------------
1614   1300.66         1371     -5.13
1767   1423.96         1500     -5.07
1932   1556.92         1638     -4.95
2099   1691.50         1778     -4.86
2297   1851.06         1944     -4.78
2530   2038.83         2136     -4.55
2796   2253.19         2351     -4.16
3051   2458.68         2546     -3.43
3285   2647.25         2715     -2.50
3559   2868.06         2895     -0.93
3937   3172.67         3094      2.54
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
3887   3132.38         3072      1.97
3452   2781.83         2827     -1.60
3191   2571.50         2650     -2.96
2976   2398.24         2490     -3.69
RAW    U_man(mV)    U_cal(mV)    Error(%)
-----------------------------------------
2781   2241.10         2339     -4.19
2601   2096.04         2194     -4.46
2413   1944.54         2041     -4.73
2207   1778.53         1869     -4.84
2031   1636.70         1722     -4.95
1855   1494.87         1573     -4.97
1663   1340.15         1413     -5.16
1487   1198.32         1266     -5.35
1290   1039.56         1101     -5.58
1044    841.32          897     -6.21
 812    654.36          704     -7.05
 565    455.31          497     -8.39
 311    250.62          277     -9.52
  69     55.60           62    -10.32
   0      0.00            0      0.00
   0      0.00            0      0.00
   0      0.00            0      0.00
   0      0.00            0      0.00
   0      0.00            0      0.00
   0      0.00            0      0.00
RAW    U_man(mV)    U_cal(mV)    Error(%)
-----------------------------------------
   3      2.42            2     20.88
 215    173.26          192     -9.76
 445    358.61          393     -8.75
 667    537.51          582     -7.64
 919    740.59          793     -6.61
1161    935.60          994     -5.87
1368   1102.42         1166     -5.45
1612   1299.05         1370     -5.18
1839   1481.98         1561     -5.06
2099   1691.50         1778     -4.86
2374   1913.11         2008     -4.73
2654   2138.75         2238     -4.43
2915   2349.08         2444     -3.88
3158   2544.91         2625     -3.05
3475   2800.37         2842     -1.46
3775   3042.12         3016      0.87
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
RAW    U_man(mV)    U_cal(mV)    Error(%)
-----------------------------------------
4095   3300.00         3157      4.53
4095   3300.00         3157      4.53
4073   3282.27         3149      4.23
3553   2863.22         2891     -0.96
3166   2551.36         2631     -3.03
2828   2278.97         2376     -4.08
2577   2076.70         2175     -4.52
2294   1848.64         1941     -4.76
2009   1618.97         1703     -4.93
1689   1361.10         1434     -5.08
1333   1074.21         1138     -5.61
1019    821.17          876     -6.26
 687    553.63          599     -7.57
 351    282.86          312     -9.34
 175    141.03          158    -10.74
 127    102.34          115    -11.00
  38     30.62           34     -9.93
   0      0.00            0      0.00
```

</details>

### Meaning

At maximum RAW value (4095), the manually calculated voltage assuming ideal 3.3V full-scale equals 3300mV. However, the calibrated ADC reports approximately 3157mV.  
This indicates that the real full-scale voltage of the ADC with 11dB attenuation on this chip is approximately 3.16V, which differs from the ideal 3.3V assumption by about 4.5%.  
This deviation is caused by internal ADC reference variation and attenuation circuit tolerances.  
